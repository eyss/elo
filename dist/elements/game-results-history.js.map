{"version":3,"file":"game-results-history.js","sourceRoot":"","sources":["../../src/elements/game-results-history.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from 'lit';\nimport { styleMap } from 'lit/directives/style-map.js';\nimport { contextProvided } from '@holochain-open-dev/context';\n\nimport {\n  Card,\n  List,\n  ListItem,\n  Icon,\n  CircularProgress,\n} from '@scoped-elements/material-web';\nimport { StoreSubscriber } from 'lit-svelte-stores';\nimport { ScopedElementsMixin } from '@open-wc/scoped-elements';\n\nimport { EloStore, ShortResult } from '../state/elo-store';\nimport { eloStoreContext } from '../context';\nimport { GameResult } from '../types';\nimport { headerTimestamp } from '../utils';\nimport { sharedStyles } from '../shared-styles';\n\nexport class GameResultsHistory extends ScopedElementsMixin(LitElement) {\n  @contextProvided({ context: eloStoreContext })\n  _eloStore!: EloStore;\n\n  _knownProfiles = new StoreSubscriber(\n    this,\n    () => this._eloStore.profilesStore.knownProfiles\n  );\n\n  _myGameResults = new StoreSubscriber(\n    this,\n    () => this._eloStore.myGameResults\n  );\n\n  async firstUpdated() {\n    await this._eloStore.fetchMyGameResults();\n\n    const opponentKeys = this._myGameResults.value.map(gameResult =>\n      this._eloStore.getOpponent(gameResult[1])\n    );\n\n    await this._eloStore.profilesStore.fetchAgentsProfiles(opponentKeys);\n  }\n\n  getIcon(result: GameResult) {\n    if (this._eloStore.getMyResult(result) === ShortResult.Win)\n      return 'thumb_up';\n    if (this._eloStore.getMyResult(result) === ShortResult.Loss)\n      return 'thumb_down';\n    return 'drag_handle';\n  }\n\n  getColor(result: GameResult) {\n    if (this._eloStore.getMyResult(result) === ShortResult.Draw) return 'grey';\n    if (this._eloStore.getMyResult(result) === ShortResult.Win) return 'green';\n    return 'red';\n  }\n\n  getSummary() {\n    const summary = {\n      [ShortResult.Draw]: 0,\n      [ShortResult.Loss]: 0,\n      [ShortResult.Win]: 0,\n    };\n\n    for (const result of this._myGameResults.value) {\n      summary[this._eloStore.getMyResult(result[1]) as ShortResult] += 1;\n    }\n\n    return summary;\n  }\n\n  renderResults() {\n    if (this._myGameResults.value.length === 0)\n      return html`<div class=\"column center-content\" style=\"flex: 1;\">\n        <span class=\"placeholder\" style=\"padding: 24px;\"\n          >There are no games in your history yet</span\n        >\n      </div>`;\n\n    return html`<div class=\"flex-scrollable-parent\">\n      <div class=\"flex-scrollable-container\">\n        <div class=\"flex-scrollable-y\">\n          <mwc-list noninteractive>\n            ${this._myGameResults.value.map(\n              result =>\n                html`<mwc-list-item twoline graphic=\"icon\">\n                  <span\n                    >vs\n                    ${this._knownProfiles.value[\n                      this._eloStore.getOpponent(result[1])\n                    ]?.nickname}\n                  </span>\n                  <span slot=\"secondary\"\n                    >${new Date(\n                      headerTimestamp(result[0])\n                    ).toLocaleString()}</span\n                  >\n                  <mwc-icon\n                    slot=\"graphic\"\n                    style=${styleMap({\n                      color: this.getColor(result[1]),\n                    })}\n                    >${this.getIcon(result[1])}</mwc-icon\n                  >\n                </mwc-list-item>`\n            )}\n          </mwc-list>\n        </div>\n      </div>\n    </div>`;\n  }\n\n  render() {\n    if (!this._myGameResults.value)\n      return html`<div class=\"column center-content\" style=\"flex: 1;\">\n        <mwc-circular-progress indeterminate></mwc-circular-progress>\n      </div>`;\n\n    const summary = this.getSummary();\n\n    return html`\n      <mwc-card style=\"flex: 1; min-width: 270px;\">\n        <div class=\"column\" style=\"margin: 16px; flex: 1;\">\n          <span class=\"title\">Game History</span>\n          ${this.renderResults()}\n          <div class=\"row center-content\">\n            <span class=\"placeholder\"\n              >Summary: ${summary[ShortResult.Win]}\n              ${summary[ShortResult.Win] === 1 ? 'win' : 'wins'},\n              ${summary[ShortResult.Loss]}\n              ${summary[ShortResult.Loss] === 1 ? 'loss' : 'losses'},\n              ${summary[ShortResult.Draw]}\n              ${summary[ShortResult.Draw] === 1 ? 'draw' : 'draws'}</span\n            >\n          </div>\n        </div>\n      </mwc-card>\n    `;\n  }\n\n  static get scopedElements() {\n    return {\n      'mwc-icon': Icon,\n      'mwc-card': Card,\n      'mwc-list': List,\n      'mwc-list-item': ListItem,\n      'mwc-circular-progress': CircularProgress,\n    };\n  }\n\n  static styles = [sharedStyles];\n}\n"]}